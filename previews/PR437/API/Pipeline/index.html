<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pipeline · CalibrateEDMF.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="CalibrateEDMF.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CalibrateEDMF.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation instructions</a></li><li><a class="tocitem" href="../../getting_started/">Getting started</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../ReferenceModels/">ReferenceModels</a></li><li><a class="tocitem" href="../ReferenceStats/">ReferenceStats</a></li><li class="is-active"><a class="tocitem" href>Pipeline</a></li><li><a class="tocitem" href="../TurbulenceConvectionUtils/">TurbulenceConvectionUtils</a></li><li><a class="tocitem" href="../KalmanProcessUtils/">KalmanProcessUtils</a></li><li><a class="tocitem" href="../DistributionUtils/">DistributionUtils</a></li><li><a class="tocitem" href="../LESUtils/">LESUtils</a></li><li><a class="tocitem" href="../HelperFuncs/">HelperFuncs</a></li></ul></li><li><a class="tocitem" href="../../tc_runner/">Running TC.jl with optimal parameters</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API</a></li><li class="is-active"><a href>Pipeline</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Pipeline</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/main/docs/src/API/Pipeline.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Pipeline"><a class="docs-heading-anchor" href="#Pipeline">Pipeline</a><a id="Pipeline-1"></a><a class="docs-heading-anchor-permalink" href="#Pipeline" title="Permalink"></a></h1><p>Module containing all high-level functions defining a training session workflow. User interactions should be done through the use of a <code>config.jl</code> file. See the <code>experiments</code> directory of the package for a few examples of <code>config.jl</code> files.</p><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.Pipeline.init_calibration" href="#CalibrateEDMF.Pipeline.init_calibration"><code>CalibrateEDMF.Pipeline.init_calibration</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">init_calibration(job_id::String, config::Dict{Any, Any})</code></pre><p>Initializes a calibration process given a configuration, and a pipeline mode.</p><p>Inputs:</p><ul><li>job_id :: Unique job identifier for sbatch communication.</li><li>config :: User-defined configuration dictionary.</li><li>mode :: Whether the calibration process is parallelized through HPC resources or using Julia&#39;s pmap.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/c27f9ad9931647df48ce40d6827f0b6c49f3c70a/src/Pipeline.jl#L26-L36">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.Pipeline.restart_calibration" href="#CalibrateEDMF.Pipeline.restart_calibration"><code>CalibrateEDMF.Pipeline.restart_calibration</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">restart_calibration(
    ekobj::EnsembleKalmanProcess,
    priors::ParameterDistribution,
    last_iteration::Int64,
    config::Dict{Any, Any},
    outdir_path::String,
)</code></pre><p>Restarts a calibration process from an EnsembleKalmanProcess, the parameter priors and the calibration process config file. If batching, it requires access to the last ReferenceModelBatch, stored in the results directory of the previous calibration, <code>outdir_path</code>.</p><p>Writes to file the ModelEvaluators necessary to continue the calibration process.</p><p>Inputs:</p><ul><li>ekobj          :: EnsembleKalmanProcess to be updated.</li><li>priors         :: Priors over parameters, used for unconstrained-constrained mappings.</li><li>last_iteration :: Last iteration of the calibration process to be restarted.</li><li>config         :: Configuration dictionary.</li><li>outdir_path    :: Output path directory of the calibration process to be restarted.</li><li>mode :: Whether the calibration process is parallelized through HPC resources or using Julia&#39;s pmap.</li><li>job_id :: Unique job identifier for sbatch communication.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/c27f9ad9931647df48ce40d6827f0b6c49f3c70a/src/Pipeline.jl#L442-L466">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.Pipeline.ek_update" href="#CalibrateEDMF.Pipeline.ek_update"><code>CalibrateEDMF.Pipeline.ek_update</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ek_update(
    ekobj::EnsembleKalmanProcess,
    priors::ParameterDistribution,
    iteration::Int64,
    config::Dict{Any, Any},
    versions::Vector{String},
    outdir_path::String,
)</code></pre><p>Updates an EnsembleKalmanProcess using forward model evaluations stored in output files defined by their <code>versions</code>, and generates the parameters for the next ensemble for forward model evaluations. The updated EnsembleKalmanProcess and new ModelEvaluators are both written to file.</p><p>Inputs:</p><ul><li>ekobj         :: EnsembleKalmanProcess to be updated.</li><li>priors        :: Priors over parameters, used for unconstrained-constrained mappings.</li><li>iteration     :: Current iteration of the calibration process.</li><li>config        :: Process configuration dictionary.</li><li>versions      :: String versions identifying the forward model evaluations.</li><li>outdir_path   :: Output path directory.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/c27f9ad9931647df48ce40d6827f0b6c49f3c70a/src/Pipeline.jl#L328-L351">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.Pipeline.update_validation" href="#CalibrateEDMF.Pipeline.update_validation"><code>CalibrateEDMF.Pipeline.update_validation</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update_validation(
    val_config::Dict{Any, Any},
    reg_config::Dict{Any, Any},
    ekp_old::EnsembleKalmanProcess,
    priors::ParameterDistribution,
    param_map::ParameterMap,
    versions::Vector{String},
    outdir_path::String,
    iteration::Integer
)</code></pre><p>Updates the validation diagnostics and writes to file the validation ModelEvaluators for the next calibration step.</p><p>Inputs:</p><ul><li>val_config    :: Validation model configuration.</li><li>reg_config    :: Regularization configuration.</li><li>ekp_old       :: EnsembleKalmanProcess updated using the past forward model evaluations.</li><li>priors        :: The priors over parameter space.</li><li>param_map     :: A mapping to a reduced parameter set. See <a href="../HelperFuncs/#CalibrateEDMF.HelperFuncs.ParameterMap"><code>ParameterMap</code></a> for details.</li><li>versions      :: String versions identifying the forward model evaluations.</li><li>outdir_path   :: Output path directory.</li><li>iteration     :: EKP iteration</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/c27f9ad9931647df48ce40d6827f0b6c49f3c70a/src/Pipeline.jl#L263-L288">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.Pipeline.update_minibatch_inverse_problem" href="#CalibrateEDMF.Pipeline.update_minibatch_inverse_problem"><code>CalibrateEDMF.Pipeline.update_minibatch_inverse_problem</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update_minibatch_inverse_problem(
    rm_batch::ReferenceModelBatch,
    ekp_old::EnsembleKalmanProcess,
    priors::ParameterDistribution,
    batch_size::Integer,
    outdir_path::String,
    config::Dict{Any, Any},
)</code></pre><p>Returns the EnsembleKalmanProcess and ReferenceStatistics consistent with the new ReferenceModel minibatch, and updates the evaluation order of the ReferenceModelBatch.</p><p>Inputs:</p><ul><li>rm_batch    :: The global ReferenceModelBatch with the current model evaluation order.</li><li>ekp_old     :: The EnsembleKalmanProcess from the previous minibatch evaluation.</li><li>batch_size  :: The batch size of the current minibatch.</li><li>outdir_path :: The output directory.</li><li>config      :: The configuration dictionary.</li></ul><p>Outputs:</p><ul><li>ekp             :: The EnsembleKalmanProcess for the current minibatch.</li><li>ref_models      :: The current minibatch of ReferenceModels.</li><li>ref_stats       :: The ReferenceStatistics consistent with the current minibatch.</li><li>ref<em>model</em>batch :: The global ReferenceModelBatch with the updated model evaluation order.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/c27f9ad9931647df48ce40d6827f0b6c49f3c70a/src/Pipeline.jl#L727-L751">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.Pipeline.write_model_evaluators" href="#CalibrateEDMF.Pipeline.write_model_evaluators"><code>CalibrateEDMF.Pipeline.write_model_evaluators</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">write_model_evaluators(
    ekp::EnsembleKalmanProcess,
    priors::ParameterDistribution,
    param_map::ParameterMap,
    ref_models::Vector{ReferenceModel},
    ref_stats::ReferenceStatistics,
    outdir_path::String,
    iteration::Int,
)</code></pre><p>Creates and writes to file the ModelEvaluators for the current particle ensemble.</p><p>Inputs:</p><ul><li><code>ekp</code>         :: The EnsembleKalmanProcess with the current ensemble of parameter values.</li><li><code>priors</code>      :: The parameter priors.</li><li><code>param_map</code>   :: A mapping to a reduced parameter set. See <a href="../HelperFuncs/#CalibrateEDMF.HelperFuncs.ParameterMap"><code>ParameterMap</code></a> for details.</li><li><code>ref_models</code>  :: The ReferenceModels defining the new model evaluations.</li><li><code>ref_stats</code>   :: The ReferenceStatistics corresponding to passed <code>ref_models</code>.</li><li><code>outdir_path</code> :: The output directory.</li><li><code>iteration</code>   :: The current process iteration.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/c27f9ad9931647df48ce40d6827f0b6c49f3c70a/src/Pipeline.jl#L803-L824">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.Pipeline.init_diagnostics" href="#CalibrateEDMF.Pipeline.init_diagnostics"><code>CalibrateEDMF.Pipeline.init_diagnostics</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">init_diagnostics(
    config::Dict{Any, Any},
    outdir_path::String,
    ref_stats::ReferenceStatistics,
    ekp::EnsembleKalmanProcess,
    priors::ParameterDistribution,
)</code></pre><p>Creates a diagnostics netcdf file.</p><p>Inputs:</p><ul><li>config :: User-defined configuration dictionary.</li><li>outdir_path :: Path of results directory.</li><li>ref_stats :: ReferenceStatistics.</li><li>ekp :: Initial EnsembleKalmanProcess, containing parameter information, but no forward model evaluations.</li><li>priors:: Prior distributions of the parameters.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/c27f9ad9931647df48ce40d6827f0b6c49f3c70a/src/Pipeline.jl#L844-L862">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.Pipeline.update_diagnostics" href="#CalibrateEDMF.Pipeline.update_diagnostics"><code>CalibrateEDMF.Pipeline.update_diagnostics</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update_diagnostics(outdir_path::String, ekp::EnsembleKalmanProcess, priors::ParameterDistribution)</code></pre><p>Appends diagnostics of the current iteration evaluations (i.e., forward model output metrics) and the next iteration state (i.e., parameters and parameter metrics) to a diagnostics netcdf file.</p><p>Inputs:</p><ul><li>outdir_path :: Path of results directory.</li><li>ekp :: Current EnsembleKalmanProcess.</li><li>priors:: Prior distributions of the parameters.</li><li>ref_stats :: ReferenceStatistics.</li><li>g_full :: The forward model evaluation in primitive space.</li><li>versions :: Version identifiers of the forward model evaluations at the current iteration.</li><li>val_config :: The validation configuration, if given.</li><li>batch_indices :: The indices of the ReferenceModels used in the current batch.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/c27f9ad9931647df48ce40d6827f0b6c49f3c70a/src/Pipeline.jl#L890-L906">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ReferenceStats/">« ReferenceStats</a><a class="docs-footer-nextpage" href="../TurbulenceConvectionUtils/">TurbulenceConvectionUtils »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Tuesday 2 August 2022 21:05">Tuesday 2 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
