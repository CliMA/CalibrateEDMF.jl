<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ReferenceStats · CalibrateEDMF.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="CalibrateEDMF.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CalibrateEDMF.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation instructions</a></li><li><a class="tocitem" href="../../getting_started/">Getting started</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../ReferenceModels/">ReferenceModels</a></li><li class="is-active"><a class="tocitem" href>ReferenceStats</a></li><li><a class="tocitem" href="../Pipeline/">Pipeline</a></li><li><a class="tocitem" href="../TurbulenceConvectionUtils/">TurbulenceConvectionUtils</a></li><li><a class="tocitem" href="../KalmanProcessUtils/">KalmanProcessUtils</a></li><li><a class="tocitem" href="../DistributionUtils/">DistributionUtils</a></li><li><a class="tocitem" href="../LESUtils/">LESUtils</a></li><li><a class="tocitem" href="../HelperFuncs/">HelperFuncs</a></li></ul></li><li><a class="tocitem" href="../../tc_runner/">Running TC.jl with optimal parameters</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API</a></li><li class="is-active"><a href>ReferenceStats</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ReferenceStats</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/main/docs/src/API/ReferenceStats.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ReferenceStats"><a class="docs-heading-anchor" href="#ReferenceStats">ReferenceStats</a><a id="ReferenceStats-1"></a><a class="docs-heading-anchor-permalink" href="#ReferenceStats" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.ReferenceStats.ReferenceStatistics" href="#CalibrateEDMF.ReferenceStats.ReferenceStatistics"><code>CalibrateEDMF.ReferenceStats.ReferenceStatistics</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReferenceStatistics{FT &lt;: Real, IT &lt;: Integer}</code></pre><p>A structure containing statistics from the reference model used to define a well-posed inverse problem.</p><p><strong>Fields</strong></p><ul><li><p><code>y::Vector{FT} where FT&lt;:Real</code></p><p>Reference data, length: nSim * n<em>vars * n</em>zLevels (possibly reduced by PCA)</p></li><li><p><code>Γ::AbstractMatrix{FT} where FT&lt;:Real</code></p><p>Data covariance matrix, dims: (y,y) (possibly reduced by PCA)</p></li><li><p><code>norm_vec::Array{Vector{FT}, 1} where FT&lt;:Real</code></p><p>Vector (length: <code>nSim</code>) of normalizing factors (length: <code>n_vars</code>)</p></li><li><p><code>pca_vec::Array{Union{LinearAlgebra.UniformScaling, AbstractMatrix{FT}}, 1} where FT&lt;:Real</code></p><p>Vector (length: <code>nSim</code>) of PCA projection matrices with leading eigenvectors as columns</p></li><li><p><code>y_full::Vector{FT} where FT&lt;:Real</code></p><p>Full reference data vector, length: <code>nSim * n_vars * n_zLevels</code></p></li><li><p><code>Γ_full::SparseArrays.SparseMatrixCSC{FT, Int64} where FT&lt;:Real</code></p><p>Full covariance matrix, dims: (y,y)</p></li><li><p><code>ndof_case::Vector{IT} where IT&lt;:Integer</code></p><p>Degrees of freedom per case (possibly reduced by PCA)</p></li><li><p><code>ndof_full_case::Vector{IT} where IT&lt;:Integer</code></p><p>Full degrees of freedom per case: <code>zdof * n_vars</code></p></li><li><p><code>zdof::Vector{IT} where IT&lt;:Integer</code></p><p>Vertical degrees of freedom in profiles per case</p></li></ul><p><strong>Constructors</strong></p><pre><code class="nohighlight hljs">ReferenceStatistics(
    RM::Vector{ReferenceModel};
    perform_PCA::Bool = true,
    normalize::Bool = true,
    variance_loss::FT = 0.1,
    tikhonov_noise::FT = 0.0,
    tikhonov_mode::String = &quot;absolute&quot;,
    dim_scaling::Bool = false,
    Δt::FT = 6 * 3600.0,
    model_errors::OptVec{T} = nothing,
) where {FT &lt;: Real}</code></pre><p>Constructs the ReferenceStatistics defining the inverse problem.</p><p>Inputs:</p><ul><li><code>RM</code>               :: Vector of <code>ReferenceModel</code>s.</li><li><code>perform_PCA</code>      :: Boolean specifying whether to perform PCA.</li><li><code>normalize</code>        :: Boolean specifying whether to normalize the data.</li><li><code>variance_loss</code>    :: Fraction of variance loss when performing PCA.</li><li><code>tikhonov_noise</code>   :: Tikhonov regularization factor for covariance matrices.</li><li><code>tikhonov_mode</code>    :: If &quot;relative&quot;, tikhonov_noise is scaled by the maximum  eigenvalue in the covariance matrix considered, having the interpretation of  the inverse of the desired condition number. This value is enforced to be  larger than the sqrt of the machine precision for stability.</li><li><code>dim_scaling</code>      :: Whether to scale covariance blocks by their size.</li><li><code>Δt</code>               :: [LES last time - SCM start time (LES timeframe)] for <code>LES_driven_SCM</code> cases.</li><li><code>model_errors</code>     :: Vector of model errors added to the internal variability noise, each containing                          the model error per variable normalized by the pooled variable variance.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/e4505d0d3531c3eb9c2b6b21fe4838879aa5fa01/src/ReferenceStats.jl#L20-L60">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.ReferenceStats.get_obs" href="#CalibrateEDMF.ReferenceStats.get_obs"><code>CalibrateEDMF.ReferenceStats.get_obs</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_obs(m::ReferenceModel, y_names, Σ_names, normalize; [z_scm])
get_obs(m::ReferenceModel, normalize; [z_scm])</code></pre><p>Get observational mean <code>y</code> and empirical time covariance <code>Σ</code> for the <a href="../ReferenceModels/#CalibrateEDMF.ReferenceModels.ReferenceModel"><code>ReferenceModel</code></a> <code>m</code>.</p><p>Typically, the observations are fetched by specifying the <code>ReferenceModel</code>, which indicates if the data is generated by the <a href="API/@ref"><code>SCM</code></a> or <a href="API/@ref"><code>LES</code></a>. Alternatively, vectors of variable names, <code>y_names</code>, <code>Σ_names</code>, can be specified directly. Note: <code>Σ_names</code> may be different than <code>y_names</code> if there are LES/SCM name discrepancies.</p><p>The keyword <code>normalize</code> specifies whether observations are to be normalized with respect to the  per-quantity pooled variance or not. See <a href="../HelperFuncs/#CalibrateEDMF.HelperFuncs.normalize_profile"><code>normalize_profile</code></a> for details. The normalization vector is return along with <code>y</code> and <code>Σ</code>.</p><p>If <code>z_scm</code> is given, interpolate observations to the given levels.</p><p><strong>Arguments</strong></p><ul><li><code>m</code>            :: A <code>ReferenceModel</code>](@ref)</li><li><code>y_names</code>      :: Names of observed fields from the <a href="../ReferenceModels/#CalibrateEDMF.ReferenceModels.ReferenceModel"><code>ReferenceModel</code></a> <code>m</code>.</li><li><code>Σ_names</code>      :: Names of fields used to construct covariances, may be different than <code>y_names</code>   if there are LES/SCM name discrepancies.</li><li><code>normalize</code>    :: Whether to normalize the observations.</li></ul><p><strong>Keywords</strong></p><ul><li><code>z_scm</code>        :: If given, interpolate LES observations to given array of vertical levels.</li><li><code>model_error</code>  :: Model error per variable, added to the internal variability noise, and                   normalized by the pooled variance of the variable.</li></ul><p><strong>Returns</strong></p><ul><li><code>y::Vector</code>           :: Mean of observations <code>y</code>, possibly interpolated to <code>z_scm</code> levels.</li><li><code>Σ::Matrix</code>           :: Observational covariance matrix <code>Σ</code>, possibly pool-normalized.</li><li><code>norm_vec::Vector</code>    :: Vertically averaged time-variance, one entry for each variable</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/e4505d0d3531c3eb9c2b6b21fe4838879aa5fa01/src/ReferenceStats.jl#L173-L206">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.ReferenceStats.obs_PCA" href="#CalibrateEDMF.ReferenceStats.obs_PCA"><code>CalibrateEDMF.ReferenceStats.obs_PCA</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">obs_PCA(y_mean, y_var, allowed_var_loss = 1.0e-1)</code></pre><p>Perform dimensionality reduction using principal component analysis on the variance <code>y_var</code>. Only eigenvectors with eigenvalues that contribute to the leading 1-<code>allowed_var_loss</code> variance are retained. Inputs:</p><ul><li><code>y_mean</code>           :: Mean of the observations.</li><li><code>y_var</code>            :: Variance of the observations.</li><li><code>allowed_var_loss</code> :: Maximum variance loss allowed.</li></ul><p>Outputs:</p><ul><li><code>y_pca</code>            :: Projection of <code>y_mean</code> onto principal subspace spanned by eigenvectors.</li><li><code>y_var_pca</code>        :: Projection of <code>y_var</code> on principal subspace.</li><li><code>P_pca</code>            :: Projection matrix onto principal subspace, with leading eigenvectors as columns.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/e4505d0d3531c3eb9c2b6b21fe4838879aa5fa01/src/ReferenceStats.jl#L237-L254">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.ReferenceStats.pca" href="#CalibrateEDMF.ReferenceStats.pca"><code>CalibrateEDMF.ReferenceStats.pca</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pca(covmat::AbstractMatrix{FT}, allowed_var_loss::FT) where {FT &lt;: Real}</code></pre><p>Perform dimensionality reduction using principal component analysis on the variance covmat.</p><p>Inputs:</p><ul><li><code>covmat</code>           :: Variance of the observations.</li><li><code>allowed_var_loss</code> :: Maximum variance loss allowed.</li></ul><p>Outputs:</p><ul><li><code>λ_pca</code>            :: Principal eigenvalues, ordered in increasing value order.</li><li><code>P_pca</code>            :: Projection matrix onto principal subspace, with leading eigenvectors as columns.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/e4505d0d3531c3eb9c2b6b21fe4838879aa5fa01/src/ReferenceStats.jl#L263-L275">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.ReferenceStats.pca_length" href="#CalibrateEDMF.ReferenceStats.pca_length"><code>CalibrateEDMF.ReferenceStats.pca_length</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Returns dimensionality of the ReferenceStatistics in low-dimensional latent space</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/e4505d0d3531c3eb9c2b6b21fe4838879aa5fa01/src/ReferenceStats.jl#L152">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.ReferenceStats.full_length" href="#CalibrateEDMF.ReferenceStats.full_length"><code>CalibrateEDMF.ReferenceStats.full_length</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Returns full dimensionality of the ReferenceStatistics, before latent space encoding</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/e4505d0d3531c3eb9c2b6b21fe4838879aa5fa01/src/ReferenceStats.jl#L155">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.ReferenceStats.get_profile" href="#CalibrateEDMF.ReferenceStats.get_profile"><code>CalibrateEDMF.ReferenceStats.get_profile</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_profile(
    filename::String,
    y_names::Vector{String};
    ti::Real = 0.0,
    tf::OptReal = nothing,
    z_scm::Union{Vector{T}, T} = nothing,
    prof_ind::Bool = false,
) where {T}
get_profile(
    m::ReferenceModel,
    filename::String;
    z_scm::Union{Vector{T}, T} = nothing,
    prof_ind::Bool = false,
) where {T}
get_profile(
    m::ReferenceModel,
    filename::String,
    y_names::Vector{String};
    z_scm::Union{Vector{T}, T} = nothing,
    prof_ind::Bool = false,
) where {T}</code></pre><p>Get time-averaged profiles for variables <code>y_names</code>, interpolated to <code>z_scm</code> (if given), and concatenated into a single output vector.</p><p>Inputs:</p><ul><li><code>filename</code>    :: nc filename</li><li><code>y_names</code>     :: Names of variables to be retrieved.</li><li><code>ti</code>          :: Initial time of averaging window.</li><li><code>tf</code>          :: Final time of averaging window.</li><li><code>z_scm</code>       :: If given, interpolate LES observations to given levels.</li><li><code>m</code>           :: ReferenceModel from which to fetch profiles, implicitly defines <code>ti</code> and <code>tf</code>.</li><li><code>prof_ind</code>    :: Whether to return a boolean array indicating the variables that are profiles (i.e., not scalars). </li></ul><p>Outputs:</p><ul><li><code>y</code> :: Output vector used in the inverse problem, which concatenates the requested profiles.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/e4505d0d3531c3eb9c2b6b21fe4838879aa5fa01/src/ReferenceStats.jl#L286-L325">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrateEDMF.ReferenceStats.get_time_covariance" href="#CalibrateEDMF.ReferenceStats.get_time_covariance"><code>CalibrateEDMF.ReferenceStats.get_time_covariance</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_time_covariance(
    m::ReferenceModel,
    y_names::Vector{String},
    z_scm::Vector{FT};
    normalize::Bool = true,
    model_error::OptVec{FT} = nothing,
) where {FT &lt;: Real}</code></pre><p>Obtain the covariance matrix of a group of profiles, where the covariance is obtained in time.</p><p>Inputs:</p><ul><li><code>m</code>            :: Reference model.</li><li><code>y_names</code>      :: List of variable names to be included.</li><li><code>z_scm</code>        :: If given, interpolates covariance matrix to this locations.</li><li><code>normalize</code>    :: Whether to normalize the time series with the pooled variance      before computing the covariance, or not.</li><li><code>model_error</code>  :: Model error per variable, added to the internal variability noise, and                  normalized by the pooled variance of the variable.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/e4505d0d3531c3eb9c2b6b21fe4838879aa5fa01/src/ReferenceStats.jl#L400-L420">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ReferenceModels/">« ReferenceModels</a><a class="docs-footer-nextpage" href="../Pipeline/">Pipeline »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 6 October 2022 22:55">Thursday 6 October 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
