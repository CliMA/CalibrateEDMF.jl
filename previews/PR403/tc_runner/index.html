<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running TC.jl with optimal parameters · CalibrateEDMF.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="CalibrateEDMF.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">CalibrateEDMF.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation instructions</a></li><li><a class="tocitem" href="../getting_started/">Getting started</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../API/Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../API/ReferenceModels/">ReferenceModels</a></li><li><a class="tocitem" href="../API/ReferenceStats/">ReferenceStats</a></li><li><a class="tocitem" href="../API/Pipeline/">Pipeline</a></li><li><a class="tocitem" href="../API/TurbulenceConvectionUtils/">TurbulenceConvectionUtils</a></li><li><a class="tocitem" href="../API/KalmanProcessUtils/">KalmanProcessUtils</a></li><li><a class="tocitem" href="../API/DistributionUtils/">DistributionUtils</a></li><li><a class="tocitem" href="../API/LESUtils/">LESUtils</a></li><li><a class="tocitem" href="../API/HelperFuncs/">HelperFuncs</a></li></ul></li><li class="is-active"><a class="tocitem" href>Running TC.jl with optimal parameters</a><ul class="internal"><li><a class="tocitem" href="#TCRunner.jl"><span>TCRunner.jl</span></a></li><li><a class="tocitem" href="#DiagnosticsTools.jl"><span>DiagnosticsTools.jl</span></a></li></ul></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Running TC.jl with optimal parameters</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running TC.jl with optimal parameters</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/CalibrateEDMF.jl/blob/main/docs/src/tc_runner.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Diagnostics-Tools"><a class="docs-heading-anchor" href="#Diagnostics-Tools">Diagnostics Tools</a><a id="Diagnostics-Tools-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics-Tools" title="Permalink"></a></h1><p>A general set of tools for analyzing <code>CalibrateEDMF.jl</code> output and running <code>TurbulenceConvection.jl</code> with optimal parameters.</p><h2 id="TCRunner.jl"><a class="docs-heading-anchor" href="#TCRunner.jl">TCRunner.jl</a><a id="TCRunner.jl-1"></a><a class="docs-heading-anchor-permalink" href="#TCRunner.jl" title="Permalink"></a></h2><p>A command line script for running <code>TurbulenceConvection.jl</code> with a set of optimal parameters determined from <code>CalibrateEDMF.jl</code> on various datasets (<code>--run_set</code>). Runs validation cases from CEDMF config in <code>--results_dir</code> with optimal parameters by default. Ideally, calibration hyperparmeters and variations of the EDMF model are chosen using results on the validation set and offline performance is evaluated on the test set. Available <code>run_set</code>s:</p><table><tr><th style="text-align: right"><code>run_set</code></th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>reference</code></td><td style="text-align: right">Run TC with optimal parameters on all cases in the training set (<code>reference</code> in the calibration config.)</td></tr><tr><td style="text-align: right"><code>validation</code></td><td style="text-align: right">Run TC with optimal parameters on all cases in the validation set (<code>validation</code> in the calibration config.)</td></tr><tr><td style="text-align: right"><code>test</code></td><td style="text-align: right">Run TC with optimal parameters on all cases in a newly-defined test set, (cases defined in <code>get_reference_config(::ScmTest)</code> in the config file defined at <code>--run_set_config</code>). See <code>tools/test_set_config.jl</code> for an example.</td></tr></table><h4 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h4><pre><code class="nohighlight hljs">julia --project TCRunner.jl --results_dir=&lt;CEDMF OUTPUT DIR&gt; --tc_output_dir=&lt;DIR TO STORE TC OUTPUTS&gt;</code></pre><p>or use optional arguments for determining optimal parameters. For example, to run TC using parameters of the particle with lowest mse on the validation set:</p><pre><code class="nohighlight hljs">julia --project TCRunner.jl --results_dir=&lt;CEDMF OUTPUT DIR&gt; --tc_output_dir=&lt;DIR TO STORE TC OUTPUTS&gt; --method=&quot;best_particle&quot; --metric=&quot;val_mse_full&quot;</code></pre><h2 id="DiagnosticsTools.jl"><a class="docs-heading-anchor" href="#DiagnosticsTools.jl">DiagnosticsTools.jl</a><a id="DiagnosticsTools.jl-1"></a><a class="docs-heading-anchor-permalink" href="#DiagnosticsTools.jl" title="Permalink"></a></h2><p>Utility functions to determine optimal parameters and mse values from completed calibration runs.</p><h4 id="Usage-2"><a class="docs-heading-anchor" href="#Usage-2">Usage</a><a class="docs-heading-anchor-permalink" href="#Usage-2" title="Permalink"></a></h4><pre><code class="nohighlight hljs">u_names, u = optimal_parameters(&lt;PATH TO &quot;Diagnostics.nc&quot;&gt;; method = &quot;best_nn_particle_mean&quot;, metric = &quot;mse_full&quot;)</code></pre><p>Given path to <code>Diagnostics.nc</code> file, return optimal parameter set across all iterations and corresponding parameter names. Defaults to particle nearest to ensemble mean (nearest neighbor) for the iteration with minimal mean mse on the training set. See docstring or table below for more options.</p><pre><code class="nohighlight hljs">optimal_mse_train, optimal_mse_val = optimal_mse(&lt;PATH TO &quot;Diagnostics.nc&quot;&gt;; method = &quot;best_nn_particle_mean&quot;, metric = &quot;mse_full&quot;)</code></pre><p>Given path to <code>Diagnostics.nc</code> file, return minimum mse across iterations. Use in concert with <code>optimal_parameters</code> to find the mse associated with a set of optimal parameters. Defaults to returning training and validation mse of particle nearest to ensemble mean for the iteration with minimal mse on the training set.</p><h6 id="Optimal-Parameter-Methods"><a class="docs-heading-anchor" href="#Optimal-Parameter-Methods">Optimal Parameter Methods</a><a id="Optimal-Parameter-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-Parameter-Methods" title="Permalink"></a></h6><table><tr><th style="text-align: right"><code>method</code></th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>best_nn_particle_mean</code></td><td style="text-align: right">Returns parameters for particle nearest to ensemble mean for the iteration with lowest mean training (<code>metric</code> = <code>&quot;mse_full&quot;</code>) or validation (<code>metric</code> = <code>&quot;val_mse_full&quot;</code>) mse.</td></tr><tr><td style="text-align: right"><code>best_particle</code></td><td style="text-align: right">Returns parameters for particle with lowest mse on training (<code>metric</code> = <code>&quot;mse_full&quot;</code>) or validation (<code>metric</code> = <code>&quot;val_mse_full&quot;</code>) set.</td></tr></table><h6 id="Optimal-Parameter-Metrics"><a class="docs-heading-anchor" href="#Optimal-Parameter-Metrics">Optimal Parameter Metrics</a><a id="Optimal-Parameter-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-Parameter-Metrics" title="Permalink"></a></h6><table><tr><th style="text-align: right"><code>metric</code></th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>mse_full</code></td><td style="text-align: right">Find minimal mse of training set or mini-batch subset (<code>reference</code> in the calibration config.)</td></tr><tr><td style="text-align: right"><code>val_mse_full</code></td><td style="text-align: right">Find minimal mse of validation set or mini-batch subset (<code>validation</code> in the calibration config.)</td></tr></table><p>Note that using mini-batching will result in an mse computed on a subset of the full training or validation dataset, so it is advantageous to evaluate (<code>metric</code> = <code>&quot;val_mse_full&quot;</code>) on a validation set without batching if batching is used for the training set. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../API/HelperFuncs/">« HelperFuncs</a><a class="docs-footer-nextpage" href="../contributing/">Contributing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Tuesday 28 June 2022 21:13">Tuesday 28 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
